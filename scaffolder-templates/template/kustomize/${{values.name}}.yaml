apiVersion: pulumi.com/v1
kind: Program
metadata:
  name: ${{values.name }}
program:
  resources:
    bucket:
      type: aws:s3:Bucket
      properties:
        website:
          indexDocument: index.html
    index.html:
      type: aws:s3:BucketObject
      properties:
        bucket: ${bucket.id}
        content: <h1>${{values.content}}</h1>
        contentType: text/html
        acl: public-read
  outputs:
    url: http://${bucket.websiteEndpoint}
---
apiVersion: pulumi.com/v1
kind: Stack
metadata:
  name: ${{values.name }}
spec:
  stack: ${{values.stack}}
  envRefs:
    AWS_ACCESS_KEY_ID:
      type: secret
      secret:
        name: aws-credentials
        key: AWS_ACCESS_KEY_ID
    AWS_SECRET_ACCESS_KEY:
      type: secret
      secret:
        name: aws-credentials
        key: AWS_SECRET_ACCESS_KEY
  programRef:
    name: ${{values.name }}
  destroyOnFinalize: true
  config:
    aws:region: ${{values.region}}
